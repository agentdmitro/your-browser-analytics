/**
 * Categorization rules and helpers for background analytics.
 */

const CUSTOM_CATEGORY_RULES_KEY = 'customCategoryRules';

/**
 * Domain categorization rules - EXPANDED
 */
const CATEGORY_RULES = {
	development: [
		/^localhost/i,
		/^127\.0\.0\.1/i,
		/^0\.0\.0\.0/i,
		/^192\.168\./i,
		/^10\.\d+\.\d+\.\d+/i,
		/^172\.(1[6-9]|2\d|3[01])\./i,
		/\.local$/i,
		/\.localhost$/i,
		/\.test$/i,
		/\.dev$/i,
		/\.example$/i,
		/ngrok\.io/i,
		/ngrok-free\.app/i,
		/localtunnel\.me/i,
		/localhost\.run/i,
		/loca\.lt/i,
		/vscode\.dev/i,
		/github\.dev/i,
		/codespaces\.github/i,
		/gitpod\.io/i,
		/stackblitz\.com/i,
		/glitch\.com/i,
		/railway\.app/i,
		/render\.com/i,
		/fly\.io/i,
		/supabase\.com/i,
		/supabase\.co/i,
		/firebase\.google/i,
		/firebaseio\.com/i,
		/planetscale\.com/i,
		/neon\.tech/i,
		/upstash\.com/i,
		/mongodb\.com/i,
		/prisma\.io/i,
		/docker\.com/i,
		/hub\.docker/i,
		/kubernetes\.io/i,
		/expo\.dev/i,
		/expo\.io/i,
		/snack\.expo/i,
		/appetize\.io/i,
		/browserstack\.com/i,
		/saucelabs\.com/i,
		/lambdatest\.com/i,
		/cypress\.io/i,
		/playwright\.dev/i,
		/storybook\.js\.org/i,
		/chromatic\.com/i,
		/bit\.dev/i,
		/bundlephobia\.com/i,
		/unpkg\.com/i,
		/jsdelivr\.net/i,
		/cdnjs\.com/i,
		/skypack\.dev/i,
		/esm\.sh/i,
		/deno\.land/i,
		/pkg\.go\.dev/i,
		/crates\.io/i,
		/rubygems\.org/i,
		/nuget\.org/i,
		/maven\.org/i,
		/mvnrepository\.com/i,
		/cocoapods\.org/i,
		/pub\.dev/i,
		/hex\.pm/i,
		/hackage\.haskell/i,
		/pkg\.julialang/i,
		/github\.com/i,
		/gitlab\.com/i,
	],
	work: [
		/bitbucket\.org/i,
		/clockify\.me/i,
		/stackoverflow\.com/i,
		/stackexchange\.com/i,
		/slack\.com/i,
		/notion\.so/i,
		/notion\.com/i,
		/trello\.com/i,
		/asana\.com/i,
		/monday\.com/i,
		/jira\./i,
		/atlassian\./i,
		/confluence\./i,
		/docs\.google\.com/i,
		/sheets\.google\.com/i,
		/slides\.google\.com/i,
		/drive\.google\.com/i,
		/calendar\.google\.com/i,
		/office\.com/i,
		/linkedin\.com/i,
		/zoom\.us/i,
		/meet\.google\.com/i,
		/teams\.microsoft\.com/i,
		/miro\.com/i,
		/vercel\.com/i,
		/netlify\.com/i,
		/heroku\.com/i,
		/digitalocean\.com/i,
		/aws\.amazon\.com/i,
		/console\.cloud\.google/i,
		/azure\.microsoft\.com/i,
		/codepen\.io/i,
		/jsfiddle\.net/i,
		/codesandbox\.io/i,
		/replit\.com/i,
		/npmjs\.com/i,
		/packagist\.org/i,
		/pypi\.org/i,
		/medium\.com/i,
		/dev\.to/i,
		/hashnode\.com/i,
		/smashingmagazine\.com/i,
		/css-tricks\.com/i,
		/alistapart\.com/i,
		/baeldung\.com/i,
		/theodinproject\.com/i,
		/docs\.aws\.amazon/i,
		/developers\.google/i,
		/learn\.microsoft/i,
		/docs\.docker/i,
		/coursera\.org/i,
		/udemy\.com/i,
		/skillshare\.com/i,
		/pluralsight\.com/i,
		/egghead\.io/i,
		/frontendmasters\.com/i,
		/w3schools\.com/i,
		/mdn\.mozilla/i,
		/developer\.mozilla/i,
		/freecodecamp\.org/i,
		/outlook\./i,
	],
	social: [
		/facebook\.com/i,
		/fb\.com/i,
		/fb\.watch/i,
		/twitter\.com/i,
		/x\.com/i,
		/instagram\.com/i,
		/snapchat\.com/i,
		/reddit\.com/i,
		/old\.reddit/i,
		/redd\.it/i,
		/discord\.com/i,
		/discord\.gg/i,
		/discordapp\.com/i,
		/telegram\.org/i,
		/t\.me/i,
		/web\.telegram/i,
		/whatsapp\.com/i,
		/web\.whatsapp/i,
		/messenger\.com/i,
		/pinterest\.com/i,
		/pin\.it/i,
		/tumblr\.com/i,
		/threads\.net/i,
		/mastodon\./i,
		/mstdn\./i,
		/bsky\.app/i,
		/quora\.com/i,
		/weibo\.com/i,
		/weibo\.cn/i,
		/douyin\.com/i,
		/kuaishou\.com/i,
		/line\.me/i,
		/kakaotalk\.com/i,
		/naver\.com/i,
		/band\.us/i,
		/clubhouse\.com/i,
		/nextdoor\.com/i,
		/meetup\.com/i,
		/eventbrite\.com/i,
		/producthunt\.com/i,
		/linktr\.ee/i,
		/linktree\.com/i,
		/bio\.link/i,
		/beacons\.ai/i,
		/stan\.store/i,
		/hackernews\.com/i,
		/news\.ycombinator/i,
		/lobste\.rs/i,
		/slashdot\.org/i,
		/digg\.com/i,
		/voat\.co/i,
		/lemmy\./i,
		/kbin\./i,
		/cohost\.org/i,
	],
	ai: [
		/openai\.com/i,
		/chatgpt\.com/i,
		/anthropic\.com/i,
		/claude\.ai/i,
		/perplexity\.ai/i,
		/gemini\.google\.com/i,
		/ai\.google/i,
		/deepmind\.com/i,
		/mistral\.ai/i,
		/cohere\.com/i,
		/groq\.com/i,
		/together\.ai/i,
		/huggingface\.co/i,
		/replicate\.com/i,
		/runwayml\.com/i,
		/midjourney\.com/i,
		/leonardo\.ai/i,
		/stability\.ai/i,
		/pika\.art/i,
		/elevenlabs\.io/i,
		/suno\.com/i,
		/udio\.com/i,
		/character\.ai/i,
		/civitai\.com/i,
		/langchain\.com/i,
		/ollama\.com/i,
		/v0\.dev/i,
		/bolt\.new/i,
		/chat\.openai\.com/i,
		/bard\.google/i,
		/gemini\.google/i,
		/aistudio\.google/i,
		/stablediffusionweb\.com/i,
		/dreamstudio\.ai/i,
		/kaiber\.ai/i,
		/anyscale\.com/i,
		/modal\.com/i,
		/poe\.com/i,
		/chai\.ml/i,
		/janitorai\.com/i,
		/crushon\.ai/i,
		/copilot\.microsoft/i,
		/github\.com\/copilot/i,
		/github\.copilot/i,
		/you\.com/i,
		/phind\.com/i,
		/sourcegraph\.com\/cody/i,
		/cursor\.sh/i,
		/cursor\.com/i,
		/codeium\.com/i,
		/tabnine\.com/i,
		/replit\.com\/ai/i,
		/amazon\.com\/codewhisperer/i,
		/codewhisperer\.aws/i,
		/sourcery\.ai/i,
		/pieces\.app/i,
		/jasper\.ai/i,
		/copy\.ai/i,
		/writesonic\.com/i,
		/rytr\.me/i,
		/anyword\.com/i,
		/wordtune\.com/i,
		/quillbot\.com/i,
		/notion\.so\/ai/i,
		/canva\.com\/ai/i,
		/adobe\.com\/firefly/i,
		/firefly\.adobe/i,
		/clipdrop\.co/i,
		/remove\.bg/i,
		/photoroom\.com/i,
		/lensa\.ai/i,
		/tome\.app/i,
		/gamma\.app/i,
		/beautiful\.ai/i,
		/slidesai\.io/i,
		/synthesia\.io/i,
		/heygen\.com/i,
		/d-id\.com/i,
		/murf\.ai/i,
		/play\.ht/i,
		/resemble\.ai/i,
		/uberduck\.ai/i,
		/descript\.com/i,
		/assemblyai\.com/i,
		/whisper\.ai/i,
		/otter\.ai/i,
		/krisp\.ai/i,
		/fathom\.video/i,
		/fireflies\.ai/i,
		/suno\.ai/i,
		/soundraw\.io/i,
		/aiva\.ai/i,
		/amper\.ai/i,
		/boomy\.com/i,
		/lalal\.ai/i,
		/moises\.ai/i,
		/labs\.google/i,
		/ai\.meta\.com/i,
		/llama\.meta\.com/i,
		/inflection\.ai/i,
		/pi\.ai/i,
		/cohere\.ai/i,
		/ai21\.com/i,
		/aleph-alpha\.com/i,
		/ollama\.ai/i,
		/lmstudio\.ai/i,
		/gpt4all\.io/i,
		/jan\.ai/i,
		/localai\.io/i,
		/koboldai\.com/i,
		/oobabooga/i,
		/text-generation-webui/i,
	],
	russia: [
		/mail\.ru/i,
		/mail\..*\.ru/i,
		/webmail\..*\.ru/i,
		/yandex\.ru/i,
		/rambler\.ru/i,
		/bk\.ru/i,
		/list\.ru/i,
		/inbox\.ru/i,
		/qip\.ru/i,
		/vk\.com/i,
		/vk\.ru/i,
		/vkontakte\.ru/i,
		/ok\.ru/i,
		/odnoklassniki\.ru/i,
		/yandex\./i,
		/ya\.ru/i,
		/lenta\.ru/i,
		/ria\.ru/i,
		/rbc\.ru/i,
		/tass\.ru/i,
		/rt\.com/i,
		/gazeta\.ru/i,
		/kommersant\.ru/i,
		/vedomosti\.ru/i,
		/interfax\.ru/i,
		/itar-tass\.com/i,
		/sputniknews\.com/i,
		/pravda\.ru/i,
		/aif\.ru/i,
		/kp\.ru/i,
		/mk\.ru/i,
		/rg\.ru/i,
		/iz\.ru/i,
		/life\.ru/i,
		/livejournal\.com/i,
		/pikabu\.ru/i,
		/habr\.com/i,
		/habrahabr\.ru/i,
		/dzen\.ru/i,
		/zen\.yandex/i,
		/rutube\.ru/i,
		/kinopoisk\.ru/i,
		/ivi\.ru/i,
		/okko\.tv/i,
		/avito\.ru/i,
		/ozon\.ru/i,
		/wildberries\.ru/i,
		/lamoda\.ru/i,
		/mvideo\.ru/i,
		/dns-shop\.ru/i,
		/citilink\.ru/i,
		/eldorado\.ru/i,
		/sberbank\.ru/i,
		/tinkoff\.ru/i,
		/vtb\.ru/i,
		/alfabank\.ru/i,
		/gosuslugi\.ru/i,
		/nalog\.ru/i,
		/mos\.ru/i,
		/kremlin\.ru/i,
		/government\.ru/i,
		/duma\.gov\.ru/i,
		/consultant\.ru/i,
		/garant\.ru/i,
		/2gis\.ru/i,
		/auto\.ru/i,
		/drom\.ru/i,
		/cian\.ru/i,
		/domclick\.ru/i,
		/hh\.ru/i,
		/superjob\.ru/i,
		/rabota\.ru/i,
	],
	design: [
		/figma\.com/i,
		/canva\.com/i,
		/behance\.net/i,
		/dribbble\.com/i,
		/adobe\.com/i,
		/sketch\.com/i,
		/invisionapp\.com/i,
		/deviantart\.com/i,
		/artstation\.com/i,
		/awwwards\.com/i,
		/cssdesignawards\.com/i,
		/siteinspire\.com/i,
		/lapa\.ninja/i,
		/landingfolio\.com/i,
		/onepagelove\.com/i,
		/mobbin\.com/i,
		/screenlane\.com/i,
		/uxarchive\.com/i,
		/collectui\.com/i,
		/uigarage\.net/i,
		/pttrns\.com/i,
		/scrnshts\.club/i,
		/godly\.website/i,
		/httpster\.net/i,
		/cssmania\.com/i,
		/fontpair\.co/i,
		/fontjoy\.com/i,
		/fonts\.google/i,
		/fonts\.adobe/i,
		/fontsquirrel\.com/i,
		/dafont\.com/i,
		/1001fonts\.com/i,
		/fontspace\.com/i,
		/myfonts\.com/i,
		/typewolf\.com/i,
		/fontsinuse\.com/i,
		/typehunting\.com/i,
		/coolors\.co/i,
		/colorhunt\.co/i,
		/color\.adobe/i,
		/colorsinspo\.com/i,
		/paletton\.com/i,
		/colourlovers\.com/i,
		/colorleap\.app/i,
		/palettegenerator\.com/i,
		/flatuicolors\.com/i,
		/materialpalette\.com/i,
		/uigradients\.com/i,
		/cssgradient\.io/i,
		/webgradients\.com/i,
		/grabient\.com/i,
		/unsplash\.com/i,
		/pexels\.com/i,
		/pixabay\.com/i,
		/stocksnap\.io/i,
		/kaboompics\.com/i,
		/burst\.shopify/i,
		/reshot\.com/i,
		/freepik\.com/i,
		/flaticon\.com/i,
		/iconmonstr\.com/i,
		/iconfinder\.com/i,
		/icons8\.com/i,
		/thenounproject\.com/i,
		/heroicons\.com/i,
		/feathericons\.com/i,
		/fontawesome\.com/i,
		/iconify\.design/i,
		/lordicon\.com/i,
		/lottiefiles\.com/i,
		/svgrepo\.com/i,
		/undraw\.co/i,
		/drawkit\.io/i,
		/humaaans\.com/i,
		/openpeeps\.com/i,
		/storyset\.com/i,
		/blush\.design/i,
		/isometric\.online/i,
		/shapefest\.com/i,
		/blobmaker\.app/i,
		/getwaves\.io/i,
		/haikei\.app/i,
		/fffuel\.co/i,
		/patternpad\.com/i,
		/heropatterns\.com/i,
		/patternico\.com/i,
		/svgbackgrounds\.com/i,
		/magicpattern\.design/i,
		/zeplin\.io/i,
		/abstract\.com/i,
		/framer\.com/i,
		/principle\.app/i,
		/protopie\.io/i,
		/origami\.design/i,
		/marvelapp\.com/i,
		/uxpin\.com/i,
		/axure\.com/i,
		/balsamiq\.com/i,
		/mockflow\.com/i,
		/wireframe\.cc/i,
		/uizard\.io/i,
		/webflow\.com/i,
		/wix\.com/i,
		/squarespace\.com/i,
		/weebly\.com/i,
		/wordpress\.com/i,
		/wordpress\.org/i,
		/elementor\.com/i,
		/divi\.com/i,
		/tilda\.cc/i,
		/readymag\.com/i,
		/carrd\.co/i,
		/cargo\.site/i,
		/format\.com/i,
		/notion\.site/i,
		/super\.so/i,
		/typedream\.com/i,
		/mmm\.page/i,
		/versoly\.com/i,
	],
	mail: [
		/mail\.google\.com/i,
		/gmail\.com/i,
		/outlook\.cloud\.microsoft/i,
		/outlook\.office\.com/i,
		/outlook\.live\.com/i,
		/outlook\.com/i,
		/live\.com/i,
		/office365\.com/i,
		/mail\.yahoo\.com/i,
		/yahoo\.com\/mail/i,
		/icloud\.com\/mail/i,
		/mail\.icloud\.com/i,
		/proton\.me/i,
		/protonmail\.com/i,
		/mail\.ukr\.net/i,
		/ukr\.net/i,
		/zoho\.com\/mail/i,
		/fastmail\.com/i,
	],
	entertainment: [
		/9gag\.com/i,
		/imgur\.com/i,
		/i\.imgur/i,
		/giphy\.com/i,
		/tenor\.com/i,
		/gfycat\.com/i,
		/streamable\.com/i,
		/rottentomatoes\.com/i,
		/imdb\.com/i,
		/metacritic\.com/i,
		/letterboxd\.com/i,
		/trakt\.tv/i,
		/justwatch\.com/i,
		/thetvdb\.com/i,
		/themoviedb\.org/i,
		/myanimelist\.net/i,
		/anilist\.co/i,
		/kitsu\.io/i,
		/anime-planet\.com/i,
		/webtoons\.com/i,
		/tapas\.io/i,
		/mangadex\.org/i,
		/mangaplus\.shueisha/i,
		/comixology\.com/i,
		/marvel\.com/i,
		/dc\.com/i,
	],
	movies: [
		/netflix\.com/i,
		/hbo\.com/i,
		/hbomax\.com/i,
		/max\.com/i,
		/hbonow\.com/i,
		/hbogo\.com/i,
		/uakino\.best/i,
		/megogo\.net/i,
		/sweet\.tv/i,
		/oll\.tv/i,
		/takflix\.com/i,
		/kyivstar\.tv/i,
		/volia\.tv/i,
	],
	video: [
		/youtube\.com/i,
		/youtu\.be/i,
		/hulu\.com/i,
		/amazon\.(com|co\.uk|ca)\/primevideo/i,
		/primevideo\.com/i,
		/disneyplus\.com/i,
		/peacocktv\.com/i,
		/paramountplus\.com/i,
		/appletv\.apple\.com/i,
		/twitch\.tv/i,
		/vimeo\.com/i,
		/dailymotion\.com/i,
		/tiktok\.com/i,
		/tv\.tiktok/i,
		/yt\.be/i,
		/disney\+/i,
		/amazon\.com\/Prime-Video/i,
		/crunchyroll\.com/i,
		/funimation\.com/i,
		/hidive\.com/i,
		/vrv\.co/i,
		/bilibili\.com/i,
		/nicovideo\.jp/i,
		/tubi\.tv/i,
		/pluto\.tv/i,
		/apple\.com\/tv/i,
		/tv\.apple/i,
		/rumble\.com/i,
		/odysee\.com/i,
		/bitchute\.com/i,
		/1plus1\.video/i,
		/ictv\.ua/i,
	],
	news: [
		/nytimes\.com/i,
		/bbc\.com/i,
		/cnn\.com/i,
		/foxnews\.com/i,
		/theguardian\.com/i,
		/reuters\.com/i,
		/apnews\.com/i,
		/bloomberg\.com/i,
		/wsj\.com/i,
		/ft\.com/i,
		/economist\.com/i,
		/forbes\.com/i,
		/businessinsider\.com/i,
		/techcrunch\.com/i,
		/wired\.com/i,
		/theverge\.com/i,
		/engadget\.com/i,
		/arstechnica\.com/i,
		/venturebeat\.com/i,
		/mashable\.com/i,
		/thenextweb\.com/i,
		/axios\.com/i,
		/newyorker\.com/i,
		/time\.com/i,
		/nationalgeographic\.com/i,
		/history\.com/i,
		/sciencedaily\.com/i,
		/newscientist\.com/i,
		/sciencemag\.org/i,
		/nature\.com/i,
		/theatlantic\.com/i,
		/slate\.com/i,
		/vox\.com/i,
		/npr\.org/i,
		/aljazeera\.com/i,
		/politico\.com/i,
		/financialpost\.com/i,
		/globeandmail\.com/i,
		/toronto\.com/i,
		/cbc\.ca/i,
		/news\./i,
		/blog\./i,
		/article\./i,
		/news-post\./i,
		/bbc\./i,
		/bbc\.co\.uk/i,
		/gizmodo\.com/i,
		/lifehacker\.com/i,
		/vice\.com/i,
		/buzzfeed\.com/i,
		/huffpost\.com/i,
		/washingtonpost\.com/i,
		/insider\.com/i,
		/cnbc\.com/i,
		/nbcnews\.com/i,
		/abcnews\.go\.com/i,
		/thehill\.com/i,
		/pravda\.com\.ua/i,
		/ukrainska-pravda/i,
		/unian\.ua/i,
		/unian\.net/i,
		/obozrevatel\.com/i,
		/tsn\.ua/i,
		/korrespondent\.net/i,
		/liga\.net/i,
		/nv\.ua/i,
		/espreso\.tv/i,
		/hromadske\.ua/i,
		/zn\.ua/i,
		/detector\.media/i,
		/babel\.ua/i,
		/focus\.ua/i,
		/gazeta\.ua/i,
		/censor\.net/i,
		/24tv\.ua/i,
		/segodnya\.ua/i,
		/ukrinform\.ua/i,
		/interfax\.com\.ua/i,
		/rbc\.ua/i,
		/epravda\.com\.ua/i,
		/zdnet\.com/i,
		/cnet\.com/i,
		/thenewstack\.io/i,
		/infoq\.com/i,
		/sdtimes\.com/i,
		/theregister\.com/i,
		/hackernoon\.com/i,
		/dzone\.com/i,
		/infoworld\.com/i,
		/techradar\.com/i,
		/9to5mac\.com/i,
		/9to5google\.com/i,
		/androidcentral\.com/i,
		/macrumors\.com/i,
		/appleinsider\.com/i,
		/bleepingcomputer\.com/i,
		/thehackernews\.com/i,
		/darkreading\.com/i,
		/krebsonsecurity\.com/i,
		/securityweek\.com/i,
		/tomshardware\.com/i,
		/anandtech\.com/i,
		/howtogeek\.com/i,
		/makeuseof\.com/i,
		/digitaltrends\.com/i,
		/pcmag\.com/i,
		/pcworld\.com/i,
		/computerworld\.com/i,
		/techdirt\.com/i,
		/torrentfreak\.com/i,
		/protocol\.com/i,
		/semafor\.com/i,
		/platformer\.news/i,
		/stratechery\.com/i,
		/techmeme\.com/i,
		/changelog\.com/i,
		/daily\.dev/i,
	],
	finance: [
		/paypal\.com/i,
		/stripe\.com/i,
		/wise\.com/i,
		/revolut\.com/i,
		/monzo\.com/i,
		/chase\.com/i,
		/bankofamerica\.com/i,
		/wellsfargo\.com/i,
		/citibank\.com/i,
		/americanexpress\.com/i,
		/discover\.com/i,
		/capitalone\.com/i,
		/coinbase\.com/i,
		/binance\.com/i,
		/kraken\.com/i,
		/robinhood\.com/i,
		/fidelity\.com/i,
		/vanguard\.com/i,
		/schwab\.com/i,
		/tdameritrade\.com/i,
		/e*trade\.com/i,
		/etrade\.com/i,
		/square\.com/i,
		/venmo\.com/i,
		/cash\.app/i,
		/zelle\.com/i,
		/transferwise\.com/i,
		/n26\.com/i,
		/chime\.com/i,
		/sofi\.com/i,
		/ally\.com/i,
		/marcus\.com/i,
		/nerdwallet\.com/i,
		/creditkarma\.com/i,
		/mint\.com/i,
		/personalcapital\.com/i,
		/ynab\.com/i,
		/experian\.com/i,
		/equifax\.com/i,
		/transunion\.com/i,
		/annualcreditreport\.com/i,
		/privatbank\.ua/i,
		/privat24\.ua/i,
		/monobank\.ua/i,
		/oschadbank\.ua/i,
		/pumb\.ua/i,
		/ukrsibbank\.com/i,
		/raiffeisen\.ua/i,
		/alfabank\.ua/i,
		/abank\.ua/i,
		/ibox\.bank/i,
		/sportbank\.ua/i,
		/sense\.privatbank/i,
		/binance\.us/i,
		/gemini\.com/i,
		/crypto\.com/i,
		/kucoin\.com/i,
		/ftx\.com/i,
		/bybit\.com/i,
		/okx\.com/i,
		/huobi\.com/i,
		/gate\.io/i,
		/bitfinex\.com/i,
		/bitstamp\.net/i,
		/blockchain\.com/i,
		/metamask\.io/i,
		/phantom\.app/i,
		/trust\.wallet/i,
		/ledger\.com/i,
		/trezor\.io/i,
		/uniswap\.org/i,
		/pancakeswap\.finance/i,
		/opensea\.io/i,
		/rarible\.com/i,
		/coingecko\.com/i,
		/coinmarketcap\.com/i,
		/etherscan\.io/i,
		/bscscan\.com/i,
		/polygonscan\.com/i,
		/solscan\.io/i,
		/tradingview\.com/i,
		/investing\.com/i,
		/finance\.yahoo/i,
		/marketwatch\.com/i,
		/seekingalpha\.com/i,
		/fool\.com/i,
		/morningstar\.com/i,
		/zacks\.com/i,
		/barrons\.com/i,
		/etoro\.com/i,
		/webull\.com/i,
		/interactivebrokers\.com/i,
		/degiro\.com/i,
		/trading212\.com/i,
		/plus500\.com/i,
		/xtb\.com/i,
		/oanda\.com/i,
		/ig\.com/i,
		/cmegroup\.com/i,
		/nasdaq\.com/i,
		/nyse\.com/i,
		/kiplinger\.com/i,
		/investopedia\.com/i,
		/benzinga\.com/i,
		/thestreet\.com/i,
		/stocktwits\.com/i,
		/finviz\.com/i,
		/crunchbase\.com/i,
		/pitchbook\.com/i,
		/cbinsights\.com/i,
		/fortune\.com/i,
		/institutionalinvestor\.com/i,
		/hedgeweek\.com/i,
		/privateequitywire\.com/i,
		/preqin\.com/i,
		/dealogic\.com/i,
		/refinitiv\.com/i,
		/spglobal\.com/i,
		/moodys\.com/i,
		/wealthfront\.com/i,
		/betterment\.com/i,
		/coindesk\.com/i,
		/cointelegraph\.com/i,
		/decrypt\.co/i,
		/theblock\.co/i,
		/defipulse\.com/i,
		/messari\.io/i,
	],
	shopping: [
		/amazon\.com/i,
		/ebay\.com/i,
		/etsy\.com/i,
		/walmart\.com/i,
		/target\.com/i,
		/bestbuy\.com/i,
		/home depot\.com/i,
		/homedepot\.com/i,
		/lowes\.com/i,
		/ikea\.com/i,
		/wayfair\.com/i,
		/aliexpress\.com/i,
		/alibaba\.com/i,
		/taobao\.com/i,
		/shopify\.com/i,
		/shop\.app/i,
		/amazon\.co\.uk/i,
		/amazon\.ca/i,
		/amazon\.de/i,
		/amazon\.fr/i,
		/amazon\.it/i,
		/amazon\.es/i,
		/amazon\.jp/i,
		/amazon\.com\.au/i,
		/ebay\.co\.uk/i,
		/ebay\.de/i,
		/ebay\.fr/i,
		/ebay\.it/i,
		/ebay\.es/i,
		/ebay\.com\.au/i,
		/ebay\.ca/i,
		/etsy\.com/i,
		/walmart\.ca/i,
		/target\.ca/i,
		/olx\.ua/i,
		/olx\.com/i,
		/olx\.pl/i,
		/rozetka\.ua/i,
		/rozetka\.com\.ua/i,
		/amazon\./i,
		/amzn\./i,
		/ebay\./i,
		/costco\.com/i,
		/overstock\.com/i,
		/newegg\.com/i,
		/bhphotovideo\.com/i,
		/1688\.com/i,
		/tmall\.com/i,
		/jd\.com/i,
		/pinduoduo\.com/i,
		/myshopify\.com/i,
		/wish\.com/i,
		/temu\.com/i,
		/shein\.com/i,
		/romwe\.com/i,
		/zaful\.com/i,
		/fashionnova\.com/i,
		/asos\.com/i,
		/zara\.com/i,
		/hm\.com/i,
		/uniqlo\.com/i,
		/gap\.com/i,
		/oldnavy\.com/i,
		/forever21\.com/i,
		/urbanoutfitters\.com/i,
		/anthropologie\.com/i,
		/freepeople\.com/i,
		/macys\.com/i,
		/nordstrom\.com/i,
		/bloomingdales\.com/i,
		/saksfifthavenue\.com/i,
		/neimanmarcus\.com/i,
		/nike\.com/i,
		/adidas\.com/i,
		/puma\.com/i,
		/underarmour\.com/i,
		/reebok\.com/i,
		/newbalance\.com/i,
		/footlocker\.com/i,
		/finishline\.com/i,
		/zappos\.com/i,
		/dsw\.com/i,
		/6pm\.com/i,
		/sephora\.com/i,
		/ulta\.com/i,
		/glossier\.com/i,
		/colourpop\.com/i,
		/craigslist\.org/i,
		/mercari\.com/i,
		/poshmark\.com/i,
		/depop\.com/i,
		/thredup\.com/i,
		/offerup\.com/i,
		/letgo\.com/i,
		/reverb\.com/i,
		/stockx\.com/i,
		/goat\.com/i,
		/grailed\.com/i,
		/ssense\.com/i,
		/mrporter\.com/i,
		/net-a-porter\.com/i,
		/farfetch\.com/i,
		/matchesfashion\.com/i,
		/prom\.ua/i,
		/allo\.ua/i,
		/comfy\.ua/i,
		/epicentrk\.ua/i,
		/makeup\.com\.ua/i,
		/citrus\.ua/i,
		/moyo\.ua/i,
		/foxtrot\.com\.ua/i,
		/hotline\.ua/i,
		/price\.ua/i,
		/zakupki\.prom\.ua/i,
		/kasta\.ua/i,
		/answear\.ua/i,
		/intertop\.ua/i,
		/leboutique\.com/i,
		/shafa\.ua/i,
		/telemart\.ua/i,
		/brain\.com\.ua/i,
		/eldorado\.ua/i,
		/stylus\.ua/i,
		/tech\.ua/i,
		/itbox\.ua/i,
		/zalando\./i,
		/asos\./i,
		/otto\.de/i,
		/aboutyou\.de/i,
		/bol\.com/i,
		/cdiscount\.com/i,
		/fnac\.com/i,
		/darty\.com/i,
		/mediamarkt\./i,
		/saturn\.de/i,
		/currys\.co\.uk/i,
		/argos\.co\.uk/i,
		/johnlewis\.com/i,
		/ocado\.com/i,
	],
	education: [
		/coursera\.org/i,
		/edx\.org/i,
		/udacity\.com/i,
		/khanacademy\.org/i,
		/ocw\.mit\.edu/i,
		/stanford\.edu/i,
		/harvard\.edu/i,
		/berkeley\.edu/i,
		/mit\.edu/i,
		/ox\.ac\.uk/i,
		/cam\.ac\.uk/i,
		/edx\.org/i,
		/udemy\.com/i,
		/udacity\.com/i,
		/pluralsight\.com/i,
		/skillshare\.com/i,
		/lynda\.com/i,
		/linkedin\.com\/learning/i,
		/codecademy\.com/i,
		/freecodecamp\.org/i,
		/w3schools\.com/i,
		/mdn\.mozilla/i,
		/wikipedia\.org/i,
		/wikimedia\.org/i,
		/wikibooks\.org/i,
		/wikiversity\.org/i,
		/wiktionary\.org/i,
		/wikiquote\.org/i,
		/wikisource\.org/i,
		/duolingo\.com/i,
		/babbel\.com/i,
		/busuu\.com/i,
		/memrise\.com/i,
		/rosettastone\.com/i,
		/italki\.com/i,
		/preply\.com/i,
		/verbling\.com/i,
		/hellotalk\.com/i,
		/tandem\.net/i,
		/quizlet\.com/i,
		/anki\.net/i,
		/ankiweb\.net/i,
		/brainly\.com/i,
		/chegg\.com/i,
		/studocu\.com/i,
		/coursehero\.com/i,
		/sparknotes\.com/i,
		/cliffsnotes\.com/i,
		/shmoop\.com/i,
		/litcharts\.com/i,
		/academia\.edu/i,
		/researchgate\.net/i,
		/scholar\.google/i,
		/semanticscholar\.org/i,
		/arxiv\.org/i,
		/biorxiv\.org/i,
		/medrxiv\.org/i,
		/ssrn\.com/i,
		/jstor\.org/i,
		/springer\.com/i,
		/sciencedirect\.com/i,
		/science\.org/i,
		/plos\.org/i,
		/pmc\.ncbi/i,
		/pubmed\.ncbi/i,
		/britannica\.com/i,
		/ted\.com/i,
		/masterclass\.com/i,
		/datacamp\.com/i,
		/treehouse\.com/i,
		/sololearn\.com/i,
		/brilliant\.org/i,
		/openlearn\.com/i,
		/class-central\.com/i,
		/alison\.com/i,
		/futurelearn\.com/i,
		/swayam\.gov\.in/i,
		/nptel\.ac\.in/i,
		/open\.edu/i,
		/leetcode\.com/i,
		/hackerrank\.com/i,
		/codewars\.com/i,
		/exercism\.org/i,
		/topcoder\.com/i,
		/codeforces\.com/i,
		/atcoder\.jp/i,
		/codingame\.com/i,
		/coderbyte\.com/i,
		/interviewbit\.com/i,
		/pramp\.com/i,
		/algoexpert\.io/i,
		/neetcode\.io/i,
		/geeksforgeeks\.org/i,
		/programiz\.com/i,
		/tutorialspoint\.com/i,
		/javatpoint\.com/i,
		/realpython\.com/i,
		/python\.org/i,
		/docs\.python/i,
		/javascript\.info/i,
		/typescript\.org/i,
		/typescriptlang\.org/i,
		/react\.dev/i,
		/vuejs\.org/i,
		/angular\.io/i,
		/svelte\.dev/i,
		/nextjs\.org/i,
		/nuxt\.com/i,
		/astro\.build/i,
		/tailwindcss\.com/i,
		/getbootstrap\.com/i,
		/sass-lang\.com/i,
		/nodejs\.org/i,
		/expressjs\.com/i,
		/fastify\.dev/i,
		/nestjs\.com/i,
		/djangoproject\.com/i,
		/flask\.palletsprojects/i,
		/rubyonrails\.org/i,
		/laravel\.com/i,
		/symfony\.com/i,
		/spring\.io/i,
		/dotnet\.microsoft/i,
		/rust-lang\.org/i,
		/go\.dev/i,
		/elixir-lang\.org/i,
		/kotlinlang\.org/i,
		/scala-lang\.org/i,
		/haskell\.org/i,
		/clojure\.org/i,
		/erlang\.org/i,
		/julia\.org/i,
	],
	productivity: [
		/notion\.so/i,
		/evernote\.com/i,
		/todoist\.com/i,
		/trello\.com/i,
		/asana\.com/i,
		/monday\.com/i,
		/airtable\.com/i,
		/miro\.com/i,
		/coda\.io/i,
		/canva\.com/i,
		/ticktick\.com/i,
		/any\.do/i,
		/wunderlist\.com/i,
		/remember-the-milk/i,
		/onenote\.com/i,
		/bear\.app/i,
		/notability\.com/i,
		/goodnotes\.com/i,
		/roamresearch\.com/i,
		/obsidian\.md/i,
		/logseq\.com/i,
		/craft\.do/i,
		/basecamp\.com/i,
		/clickup\.com/i,
		/wrike\.com/i,
		/teamwork\.com/i,
		/smartsheet\.com/i,
		/lucidchart\.com/i,
		/draw\.io/i,
		/diagrams\.net/i,
		/whimsical\.com/i,
		/excalidraw\.com/i,
		/mindmeister\.com/i,
		/xmind\.net/i,
		/grammarly\.com/i,
		/hemingwayapp\.com/i,
		/prowritingaid\.com/i,
	],
	gaming: [
		/steamcommunity\.com/i,
		/store\.steampowered\.com/i,
		/steampowered\.com/i,
		/epicgames\.com/i,
		/gog\.com/i,
		/battle\.net/i,
		/riotgames\.com/i,
		/ea\.com/i,
		/ubisoft\.com/i,
		/playstation\.com/i,
		/xbox\.com/i,
		/nintendo\.com/i,
		/roblox\.com/i,
		/minecraft\.net/i,
		/twitch\.tv/i,
		/discord\.gg/i,
		/itch\.io/i,
		/kongregate\.com/i,
		/store\.steampowered/i,
		/humblebundle\.com/i,
		/gamejolt\.com/i,
		/origin\.com/i,
		/blizzard\.com/i,
		/kick\.com/i,
		/mixer\.com/i,
		/fortnite\.com/i,
		/leagueoflegends\.com/i,
		/dota2\.com/i,
		/worldofwarcraft\.com/i,
		/valorant\.com/i,
		/callofduty\.com/i,
		/apexlegends\.com/i,
		/genshin\.hoyoverse/i,
		/mihoyo\.com/i,
		/hoyoverse\.com/i,
		/gaming\./i,
		/ign\.com/i,
		/gamespot\.com/i,
		/kotaku\.com/i,
		/polygon\.com/i,
		/rockpapershotgun\.com/i,
		/pcgamer\.com/i,
		/gamesradar\.com/i,
		/eurogamer\.net/i,
		/destructoid\.com/i,
		/giantbomb\.com/i,
		/escapistmagazine\.com/i,
		/gameinformer\.com/i,
		/nintendolife\.com/i,
		/pushsquare\.com/i,
		/purexbox\.com/i,
		/n4g\.com/i,
		/neogaf\.com/i,
		/resetera\.com/i,
		/howlongtobeat\.com/i,
		/gg\.deals/i,
		/isthereanydeal\.com/i,
		/cheapshark\.com/i,
		/steamdb\.info/i,
		/steamcharts\.com/i,
		/protondb\.com/i,
		/nexusmods\.com/i,
		/moddb\.com/i,
		/curseforge\.com/i,
		/speedrun\.com/i,
	],
	health: [
		/webmd\.com/i,
		/mayoclinic\.org/i,
		/healthline\.com/i,
		/nih\.gov/i,
		/cdc\.gov/i,
		/who\.int/i,
		/fitness\.com/i,
		/myfitnesspal\.com/i,
		/strava\.com/i,
		/headspace\.com/i,
		/calm\.com/i,
		/betterhelp\.com/i,
		/medlineplus\.gov/i,
		/drugs\.com/i,
		/rxlist\.com/i,
		/everydayhealth\.com/i,
		/verywellhealth\.com/i,
		/medicalnewstoday\.com/i,
		/patient\.info/i,
		/nhs\.uk/i,
		/fitbit\.com/i,
		/runkeeper\.com/i,
		/peloton\.com/i,
		/nike\.com\/run/i,
		/garmin\.com/i,
		/zocdoc\.com/i,
		/teladoc\.com/i,
	],
	travel: [
		/booking\.com/i,
		/airbnb\.com/i,
		/expedia\.com/i,
		/skyscanner\.com/i,
		/tripadvisor\.com/i,
		/kayak\.com/i,
		/travelocity\.com/i,
		/orbitz\.com/i,
		/priceline\.com/i,
		/uber\.com/i,
		/lyft\.com/i,
		/maps\.google\.com/i,
		/google\.com\/maps/i,
		/hotels\.com/i,
		/agoda\.com/i,
		/trivago\.com/i,
		/google\.com\/travel/i,
		/google\.com\/flights/i,
		/maps\.google/i,
		/waze\.com/i,
		/bolt\.eu/i,
		/uklon\.com/i,
		/flixbus\.com/i,
		/ryanair\.com/i,
		/easyjet\.com/i,
		/lufthansa\.com/i,
		/klm\.com/i,
		/united\.com/i,
		/delta\.com/i,
		/southwest\.com/i,
		/aa\.com/i,
		/flightradar24\.com/i,
		/rome2rio\.com/i,
		/hostelworld\.com/i,
		/couchsurfing\.com/i,
		/viator\.com/i,
		/getyourguide\.com/i,
		/lonelyplanet\.com/i,
		/tickets\.ua/i,
		/proizd\.ua/i,
		/bus\.com\.ua/i,
		/infobus\.eu/i,
		/uz\.gov\.ua/i,
	],
	music: [
		/spotify\.com/i,
		/soundcloud\.com/i,
		/bandcamp\.com/i,
		/pandora\.com/i,
		/music\.apple\.com/i,
		/music\.youtube\.com/i,
		/youtube\.com\/music/i,
		/tidal\.com/i,
		/deezer\.com/i,
		/last\.fm/i,
		/open\.spotify/i,
		/music\.apple/i,
		/music\.youtube/i,
		/audiomack\.com/i,
		/mixcloud\.com/i,
		/lastfm\.com/i,
		/shazam\.com/i,
		/napster\.com/i,
		/qobuz\.com/i,
		/idagio\.com/i,
		/primephonic\.com/i,
		/amazon\.com\/music/i,
		/music\.amazon/i,
		/genius\.com/i,
		/azlyrics\.com/i,
		/lyrics\.com/i,
		/musixmatch\.com/i,
		/songsterr\.com/i,
		/ultimate-guitar\.com/i,
		/guitartabs\.cc/i,
		/chordify\.net/i,
		/iheart\.com/i,
		/iheartradio\.com/i,
		/tunein\.com/i,
		/radio\.com/i,
		/radioparadise\.com/i,
		/soma\.fm/i,
		/di\.fm/i,
		/splice\.com/i,
		/landr\.com/i,
		/distrokid\.com/i,
		/tunecore\.com/i,
		/cdbaby\.com/i,
		/routenote\.com/i,
		/beatstars\.com/i,
		/bpm\.com/i,
		/loopmasters\.com/i,
		/discogs\.com/i,
		/allmusic\.com/i,
		/rateyourmusic\.com/i,
		/albumoftheyear\.org/i,
		/setlist\.fm/i,
		/songkick\.com/i,
		/bandsintown\.com/i,
		/concerts\.livenation/i,
		/ticketmaster\.com/i,
	],
	sports: [/espn\.com/i, /nfl\.com/i, /nba\.com/i, /mlb\.com/i, /nhl\.com/i, /fifa\.com/i, /uefa\.com/i, /olympics\.com/i],
	food: [
		/allrecipes\.com/i,
		/foodnetwork\.com/i,
		/epicurious\.com/i,
		/seriouseats\.com/i,
		/bonappetit\.com/i,
		/uber eats\.com/i,
		/ubereats\.com/i,
		/doordash\.com/i,
		/grubhub\.com/i,
		/postmates\.com/i,
		/deliveroo\.com/i,
		/justeat\./i,
		/seamless\.com/i,
		/yelp\.com/i,
		/opentable\.com/i,
		/zomato\.com/i,
		/swiggy\.com/i,
		/foodpanda\./i,
		/tasty\.co/i,
		/food\.com/i,
		/delish\.com/i,
		/cookpad\.com/i,
		/yummly\.com/i,
		/hellofresh\.com/i,
		/blueapron\.com/i,
		/glovo\.com/i,
		/raketa\.app/i,
		/silpo\.ua/i,
		/novus\.ua/i,
		/zakaz\.ua/i,
		/food\.bolt/i,
		/boltfood\.com/i,
		/sports\.yahoo/i,
		/bleacherreport\.com/i,
		/cbssports\.com/i,
		/nbcsports\.com/i,
		/foxsports\.com/i,
		/si\.com/i,
		/theathletic\.com/i,
		/thescore\.com/i,
		/sportingnews\.com/i,
		/skysports\.com/i,
		/bbc\.com\/sport/i,
		/eurosport\.com/i,
		/goal\.com/i,
		/transfermarkt\.com/i,
		/whoscored\.com/i,
		/soccerway\.com/i,
		/flashscore\.com/i,
		/sofascore\.com/i,
		/livescore\.com/i,
		/365scores\.com/i,
		/mls\.com/i,
		/premierleague\.com/i,
		/laliga\.com/i,
		/bundesliga\.com/i,
		/seriea\.com/i,
		/ligue1\.com/i,
		/f1\.com/i,
		/formula1\.com/i,
		/motogp\.com/i,
		/wwe\.com/i,
		/ufc\.com/i,
		/boxingscene\.com/i,
		/pgatour\.com/i,
		/atptour\.com/i,
		/wtatennis\.com/i,
		/tribuna\.com/i,
		/football\.ua/i,
		/sport\.ua/i,
		/isport\.ua/i,
		/ua-football\.com/i,
		/footboom\.com/i,
	],
	adult: [
		/pornhub\.com/i,
		/xvideos\.com/i,
		/xhamster\.com/i,
		/redtube\.com/i,
		/youporn\.com/i,
		/xnxx\.com/i,
		/xnxx\.com/i,
		/hentai\.org/i,
		/f95zone\.to/i,
		/e-hentai\.org/i,
		/nhentai\.net/i,
		/onlyfans\.com/i,
		/fansly\.com/i,
		/patreon\.com/i,
	],
	security: [
		/owasp\.org/i,
		/sans\.org/i,
		/mitre\.org/i,
		/attack\.mitre/i,
		/virustotal\.com/i,
		/hybrid-analysis\.com/i,
		/any\.run/i,
		/urlscan\.io/i,
		/shodan\.io/i,
		/exploit-db\.com/i,
		/hackthebox\.com/i,
		/tryhackme\.com/i,
		/pentesterlab\.com/i,
		/portswigger\.net/i,
		/burpsuite\.net/i,
		/metasploit\.com/i,
		/nmap\.org/i,
		/wireshark\.org/i,
		/snyk\.io/i,
		/sonarqube\.org/i,
		/dependabot\.com/i,
		/nordvpn\.com/i,
		/expressvpn\.com/i,
		/surfshark\.com/i,
		/protonvpn\.com/i,
		/mullvad\.net/i,
		/privateinternetaccess\.com/i,
		/cyberghostvpn\.com/i,
		/ipvanish\.com/i,
		/windscribe\.com/i,
		/tunnelbear\.com/i,
		/hidemyass\.com/i,
		/vyprvpn\.com/i,
		/1password\.com/i,
		/lastpass\.com/i,
		/bitwarden\.com/i,
		/dashlane\.com/i,
		/keeper\.com/i,
		/nordpass\.com/i,
		/authy\.com/i,
		/yubico\.com/i,
		/norton\.com/i,
		/mcafee\.com/i,
		/kaspersky\.com/i,
		/bitdefender\.com/i,
		/avast\.com/i,
		/avg\.com/i,
		/malwarebytes\.com/i,
		/eset\.com/i,
		/sophos\.com/i,
		/trendmicro\.com/i,
		/f-secure\.com/i,
		/avira\.com/i,
		/cve\.mitre\.org/i,
		/nvd\.nist\.gov/i,
		/offensive-security\.com/i,
	],
};

/**
 * URL path patterns for news/blog/article detection
 * These patterns match against the full URL path
 */
const NEWS_PATH_PATTERNS = [
	// Blog patterns
	/\/blog\//i,
	/\/blogs\//i,
	/\/weblog\//i,

	// News patterns
	/\/news\//i,
	/\/news-/i,
	/\/breaking\//i,
	/\/latest\//i,
	/\/headlines\//i,
	/\/press\//i,
	/\/press-release/i,
	/\/media\//i,
	/\/newsroom\//i,

	// Article patterns
	/\/article\//i,
	/\/articles\//i,
	/\/story\//i,
	/\/stories\//i,
	/\/post\//i,
	/\/posts\//i,
	/\/read\//i,

	// Release/Update patterns
	/\/releases\//i,
	/\/release\//i,
	/\/changelog\//i,
	/\/updates\//i,
	/\/update\//i,
	/\/whats-new/i,
	/\/announcements?\//i,

	// Editorial patterns
	/\/editorial\//i,
	/\/opinion\//i,
	/\/perspectives?\//i,
	/\/insights?\//i,
	/\/analysis\//i,
	/\/reports?\//i,
	/\/review\//i,
	/\/reviews\//i,

	// Publication patterns
	/\/publication\//i,
	/\/publications\//i,
	/\/journal\//i,
	/\/magazine\//i,
	/\/digest\//i,

	// Date-based article URLs (common pattern: /2024/01/article-name)
	/\/\d{4}\/\d{1,2}\/[a-z0-9-]+/i,

	// Content type indicators
	/\/content\//i,
	/\/featured\//i,
	/\/trending\//i,
	/\/popular\//i,
	/\/spotlight\//i,

	// Tech/Dev specific
	/\/devblog\//i,
	/\/engineering\//i,
	/\/tech-blog\//i,
	/\/developer-blog\//i,

	// Company blog patterns
	/\/company-news\//i,
	/\/corporate\//i,
	/\/about\/news/i,

	// Newsletter patterns
	/\/newsletter\//i,
	/\/subscribe\//i,
];

/**
 * Check if URL path matches news/blog patterns
 * @param {string} url - Full URL to check
 * @returns {boolean}
 */
function isNewsPath(url) {
	try {
		const urlObj = new URL(url);
		const fullPath = urlObj.pathname + urlObj.search;

		for (const pattern of NEWS_PATH_PATTERNS) {
			if (pattern.test(fullPath)) {
				return true;
			}
		}
		return false;
	} catch {
		return false;
	}
}

function ruleMatches(rule, domain, url) {
	if (!rule || !rule.pattern || !rule.category) return false;
	const pattern = String(rule.pattern).trim();
	if (!pattern) return false;

	const targetDomain = (domain || '').toLowerCase();
	const targetUrl = (url || '').toLowerCase();

	if (pattern.startsWith('/') && pattern.endsWith('/') && pattern.length > 2) {
		try {
			const re = new RegExp(pattern.slice(1, -1), 'i');
			return re.test(domain) || (url && re.test(url));
		} catch {
			return false;
		}
	}

	const needle = pattern.toLowerCase();
	return targetDomain.includes(needle) || targetUrl.includes(needle);
}

/**
 * Categorize a domain (enhanced with path detection)
 * @param {string} domain - Domain to categorize
 * @param {string} url - Full URL for path-based detection
 * @returns {string} Category name
 */
function categorize(domain, url = '') {
	// Custom rules take priority
	for (const rule of customCategoryRules) {
		if (ruleMatches(rule, domain, url)) {
			return rule.category;
		}
	}

	// First check domain-based rules
	for (const [category, patterns] of Object.entries(CATEGORY_RULES)) {
		for (const pattern of patterns) {
			if (pattern.test(domain)) {
				return category;
			}
		}
	}

	// Check URL path for news/blog patterns (for sites not in domain list)
	if (url && isNewsPath(url)) {
		return 'news';
	}

	return 'other';
}
